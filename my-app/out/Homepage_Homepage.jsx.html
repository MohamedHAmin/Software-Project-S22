<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: Homepage/Homepage.jsx</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: Homepage/Homepage.jsx</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import React, { useState, useEffect } from "react";
import "./Styles/Homepage.css";
import SideBar from "../Profile/SideBar";
import Header from "./Header";
import Tweet from "./tweet";
import TweetBar from "./TweetBar";
import Post from "./Post";
import Searchbar from "./Search";
import axios from "axios";
import { useParams } from "react-router-dom";
import InfiniteScroll from 'react-infinite-scroll-component';
import Stack from "@mui/material/Stack";

/**
 * Homepage containing area to post tweets and timeline tweets (your tweets and tweets of people you follow)
 * it also contains sidebar to navigate through pages and it also contains searchbar
 * @component 
 * @param {boolean} isAdmin indicates whether or not this home is an admin's home or a normal user's home
 * @returns {div}
 * @example
 *        &lt;Homepage isAdmin={isAdmin}/>
 */
function Homepage(props) {
  const [posts, setposts] = useState([]);
  const [token,setToken]=useState(localStorage.getItem("accessToken"));
  const [admintoken,setAdminToken]=useState(localStorage.getItem("adminToken"));
  const [text, setText] = useState("");
  const [darkMode, setDarkMode] = useState(false);
  const [photos, setuploadphotos] = useState([]);
  const [skip,setskip]=useState(0);
  const [hasmore,sethasmore]=useState(true);
  const [at, setats] = useState([]);
  const [final, setfinal] = useState([]);
  const [finalfinal, setfinalfinal] = useState([]);
  const [notificationscount,setnotificationscount]=useState(0);

  console.log( "tags"+ finalfinal[0]);
  const [space, setspaces] = useState([]);
  let { id } = useParams();
  let { screenName } = useParams();
  const getposts = () => {
    axios
      .get(
        `http://larry-env.eba-u6mbx2gb.us-east-1.elasticbeanstalk.com/api/timeline?limit=2&amp;skip=${skip}`,
        { headers: { Authorization: token } }
      )
      .then((res) => {
        if (res.error) {
          console.log(
            "There was error while attempting to retrieve tweets for timeline"
          );
        } else {
          var prevposts=posts;
          setskip(skip+2);
          //setposts(res.data);
          var currentposts=[...prevposts,...res.data];
          setposts(currentposts);
          if(prevposts.length===currentposts.length)
          {
            sethasmore(false);
          }
        }
      });
  };

  const fetchMoreData=()=>{
    getposts();
  }

  if(photos.length ===0){
  }
  else{
  
    // fileInput is an HTML input element: &lt;input type="file" id="myfileinput" multiple>
    var fileInput = document.getElementById("icon-button-file");

    // files is a FileList object (similar to NodeList)
    var files = fileInput.files;
    var file;

    // loop through files
    for (var i = 0; i &lt; files.length; i++) {

        // get item
        file = files.item(i);
        photos[i]=file
        // alert(photos[i].name);

    }
  }

  // useEffect(()=>{
  //   checkfornewnotifications();
  // },[])

  useEffect(() => {
    getposts();
    axios
      .get(`http://larry-env.eba-u6mbx2gb.us-east-1.elasticbeanstalk.com/api/profile/${id}/me`, {
        headers: { Authorization: localStorage.getItem("accessToken") },
      })
      .then((res) => {
        console.log(res);
        if (res.error) {
          console.log("Error");
        } else {
          setDarkMode(res.data.darkMode);
        }
      });
  }, [id]);
  const [selectedImage, setSelectedImage] = useState(null);
  function onimgSelectedChange(newimg) {
    setuploadphotos(newimg);
    console.log(photos);
    console.log(photos.length);
  }
  const passdeletedTweet = (id) => {
    if(props.isAdmin)
    {
      axios
      .delete(
        `http://larry-env.eba-u6mbx2gb.us-east-1.elasticbeanstalk.com/api/tweet/${id}`,
        { headers: { Authorization: admintoken } }
      )
      .then((res) => {
        console.log(res);
        if (res.error || !res.data === "success") {
          alert("something went wrong");
        } else {
          getposts();
          window.location.reload();
          window.location.reload();
        }
      })
      .catch((err) => {
        //err.message; // 'Oops!'
        alert("Error occured while deleting");
        console.log(err);
      });
    }
    else
    {
      axios
        .delete(
          `http://larry-env.eba-u6mbx2gb.us-east-1.elasticbeanstalk.com/api/tweet/${id}`,
          { headers: { Authorization: token } }
        )
        .then((res) => {
          console.log(res);
          if (res.error || !res.data === "success") {
            alert("something went wrong");
          } else {
            getposts();
            window.location.reload();
            window.location.reload();
          }
        })
        .catch((err) => {
          //err.message; // 'Oops!'
          alert("Error occured while deleting");
          console.log(err);
        });
    }
  };
  const postHandeler = () => {
    if (text != "" || photos.length) {
      let data = {
        authorId: localStorage.getItem("userId"),
        text: text,
        gallery: [],
      };
      if (text === "") {
        data.text = "No-text";
      }
      if (text != "") {


        let j=0;
        for (var i = 0; i &lt; text.length; i++) {
      
          let d=text.slice(i,i+1);
          if(d==="@"){
            at[j]=i;
            j++;
          }
        
        }
        let q=0;
        for (var i = 0; i &lt; text.length; i++) {
      
          let d=text.slice(i,i+1);
          if(d===" "){
            space[q]=i;
            q++;
          }
        
        }
        let r=0
        let w=0;
        for (var i = 0; i &lt; space.length; i++) {
          // console.log(at[w]);
          // console.log(space[i]);
          if(space[i]===at[w]+1){
            w++;
          }
          if(space[i]>at[w]+1){
            // console.log(at[w]);
            // console.log(space[i]);
            // console.log(r);
            // console.log(w);
            final[r]=at[w];
            final[r+1]=space[i];
            // console.log(final[r]);
            // console.log(final[r+1]);
            // console.log(space[i]);
            // console.log(at[w]);
            w++;
            r+=2;
          }
        }
          let u=0;
        if(final.length!=0){
         
          for (var i = 0; i &lt; final.length; i+=2) {
            // console.log(final[i]);
            // console.log(final[i+1]);
            let t=text.slice(final[i],final[i+1]);
            // console.log(t)
            finalfinal[u]=t;
            u++;
          }
        }
        // console.log(at[w]);
        // console.log(text.length);
      
        if(w&lt;at.length){
          // let p=finalfinal.length
          let x=text.slice(at[w],text.length);
          // console.log(p);
          // console.log(finalfinal.length);
          finalfinal[w]=x;
          // console.log(finalfinal.length);
          // p=-2;
          // w++;
          // console.log("doneeeeeee");
        }
        if(finalfinal.length!=0){
          for (var i = 0; i &lt; finalfinal.length; i++) {
            console.log(finalfinal[i]);
          }
        }
      }
      if (photos.length) {
        data.gallery.push({ photo: photos[0]});
      }
      let data2 = new FormData();
        //alert(photos.length);
        data2.append("authorId", data.authorId);
        data2.append("text", data.text);
        for(var i=0;i&lt;photos.length;i++){
          data2.append("image", photos[i]);
        }
        // for(var i=0;i&lt;finalfinal.length;i++){
          //   data2.append("tags", finalfinal[i]);
          // }
          if(photos.length)
          {
            data2.append("imageCheck", "true");
          }
        data2.append("tags", finalfinal[0]);
        //data2.append("tags", "1112122");
      let x = localStorage.getItem("accessToken");
      console.log(data);
      console.log(data2);
      axios
        .post(
          `http://larry-env.eba-u6mbx2gb.us-east-1.elasticbeanstalk.com/api/tweet`,
          data2,
          { headers: { Authorization: localStorage.getItem("accessToken") } }
        )
        .then((res) => {
          console.log(res);
          if (res.error) {
            alert("something went wrong");
          } else {
            getposts();
            window.location.reload();
            window.location.reload();
          }
        })
        .catch((err) => {
          alert(err.response.data.error);
          console.log(err);
        });

      setText("");
      setuploadphotos([]);
    }
  };
  // alert(id);
  console.log(posts);
  const onChangeHandeler = (event) => {
    setText(event.target.value);
  };
  return (
    &lt;div className="Homepage">
      &lt;SideBar Home isAdmin={props.isAdmin} darkMode={darkMode} newnotifications={props.newnotifications}/>
      &lt;div className="postConatiner">
        &lt;Header />
        &lt;Tweet
          value={text}
          onChangeHandeler={onChangeHandeler}
          ali={photos}
        />
        &lt;TweetBar
          postHandeler={postHandeler}
          onimgChange={onimgSelectedChange}
        />
        &lt;InfiniteScroll
          dataLength={posts.length} 
          next={fetchMoreData}
          hasMore={hasmore}
          loader={&lt;h4>Loading...&lt;/h4>}
          endMessage={&lt;>&lt;/>}
          >
        {posts.length ? (
          posts.map((post) => (
            &lt;Post
            post={post}
            passdeletedTweet={passdeletedTweet}
            isAdmin={props.isAdmin}
            isPost={true}
            canviewcomments={true}
            />
            ))
            ) : (
              &lt;Stack className="comments" direction="column">
                &lt;Stack direction="row">
                  &lt;p>No lars yet?&lt;/p>
                &lt;/Stack>
                &lt;Stack direction="row">
                  &lt;p>
                    Start following people, post lars, and
                    enjoy Larry!
                  &lt;/p>
                &lt;/Stack>
              &lt;/Stack>
            )}
          &lt;/InfiniteScroll>
      &lt;/div>
      &lt;div className="rightbar">
        &lt;div className="searchbar">
          &lt;Searchbar viewSuggestedAccounts={true}/>
        &lt;/div>
      &lt;/div>
    &lt;/div>
  );
}
export default Homepage;</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#AccInfoOptions">AccInfoOptions</a></li><li><a href="global.html#AccountInformationS">AccountInformationS</a></li><li><a href="global.html#AccountSettings">AccountSettings</a></li><li><a href="global.html#AdminDashboard">AdminDashboard</a></li><li><a href="global.html#blue">blue</a></li><li><a href="global.html#ChangeNotificationsSettings">ChangeNotificationsSettings</a></li><li><a href="global.html#ChangePhoneNum">ChangePhoneNum</a></li><li><a href="global.html#ChangeUserTag">ChangeUserTag</a></li><li><a href="global.html#CommentDisplayBlock">CommentDisplayBlock</a></li><li><a href="global.html#contact">contact</a></li><li><a href="global.html#CreateCard">CreateCard</a></li><li><a href="global.html#CreateFollower">CreateFollower</a></li><li><a href="global.html#createImage">createImage</a></li><li><a href="global.html#CreateSearchCard">CreateSearchCard</a></li><li><a href="global.html#EditProfile">EditProfile</a></li><li><a href="global.html#Explore">Explore</a></li><li><a href="global.html#FollowerCard">FollowerCard</a></li><li><a href="global.html#FollowersPage">FollowersPage</a></li><li><a href="global.html#FollowingCard">FollowingCard</a></li><li><a href="global.html#FollowingPage">FollowingPage</a></li><li><a href="global.html#Header">Header</a></li><li><a href="global.html#Homepage">Homepage</a></li><li><a href="global.html#ImageUploaderBanner">ImageUploaderBanner</a></li><li><a href="global.html#ImageUploaderProfile">ImageUploaderProfile</a></li><li><a href="global.html#Login">Login</a></li><li><a href="global.html#MakeBDvisible">MakeBDvisible</a></li><li><a href="global.html#MakeLocVisible">MakeLocVisible</a></li><li><a href="global.html#MyFollowers">MyFollowers</a></li><li><a href="global.html#MyFollowing">MyFollowing</a></li><li><a href="global.html#MyProfile">MyProfile</a></li><li><a href="global.html#MyProfileTabs">MyProfileTabs</a></li><li><a href="global.html#Navbar">Navbar</a></li><li><a href="global.html#NotificationSettings">NotificationSettings</a></li><li><a href="global.html#OthersProfile">OthersProfile</a></li><li><a href="global.html#Post">Post</a></li><li><a href="global.html#PostReplies">PostReplies</a></li><li><a href="global.html#PrivacySettings">PrivacySettings</a></li><li><a href="global.html#ProfileInfo">ProfileInfo</a></li><li><a href="global.html#ProfileName">ProfileName</a></li><li><a href="global.html#ProfilePage">ProfilePage</a></li><li><a href="global.html#Reacts">Reacts</a></li><li><a href="global.html#ReactsIcon">ReactsIcon</a></li><li><a href="global.html#Report">Report</a></li><li><a href="global.html#ReportAction">ReportAction</a></li><li><a href="global.html#ReportsPage">ReportsPage</a></li><li><a href="global.html#ReportsView">ReportsView</a></li><li><a href="global.html#RetweetDisplayBlock">RetweetDisplayBlock</a></li><li><a href="global.html#SearchFollowers">SearchFollowers</a></li><li><a href="global.html#SettingsMenu">SettingsMenu</a></li><li><a href="global.html#SettingsMenuOptions">SettingsMenuOptions</a></li><li><a href="global.html#SettingsPage">SettingsPage</a></li><li><a href="global.html#SideBar">SideBar</a></li><li><a href="global.html#SideBarIcon">SideBarIcon</a></li><li><a href="global.html#Signup">Signup</a></li><li><a href="global.html#SuggestedAccounts">SuggestedAccounts</a></li><li><a href="global.html#Tweet">Tweet</a></li><li><a href="global.html#TweetBar">TweetBar</a></li><li><a href="global.html#UpdatePassword">UpdatePassword</a></li><li><a href="global.html#UploaderBanner">UploaderBanner</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.10</a> on Mon May 23 2022 20:33:00 GMT+0200 (Eastern European Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
